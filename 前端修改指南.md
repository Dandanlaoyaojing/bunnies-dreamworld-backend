# 前端修改指南

## 推荐方案：通过后端代理

### 优点
1. ✅ **安全性**：API密钥不会暴露在前端
2. ✅ **成本控制**：后端可以限流，防止滥用
3. ✅ **易于维护**：只需要在后端管理API密钥

### 修改步骤

#### 1. 在 `aiService.js` 中找到 `callBaiduOCR` 函数

#### 2. 修改为调用后端接口：

```javascript
// 原来的代码（前端直接调用百度OCR）
async callBaiduOCR(imageUrl) {
  // ... 原来的代码 ...
}

// 改为：
async callBaiduOCR(imageUrl) {
  try {
    // 获取token
    const token = uni.getStorageSync('token');
    if (!token) {
      throw new Error('用户未登录');
    }

    // 将图片转换为base64
    const base64Image = await this.imageToBase64(imageUrl);

    // 调用后端接口
    const response = await uni.request({
      url: `${this.baseURL}/images/upload`,
      method: 'POST',
      header: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      data: {
        image: base64Image,
        doOCR: true  // 告诉后端需要进行OCR识别
      }
    });

    if (response.data.success && response.data.data.ocrResult) {
      return response.data.data.ocrResult.text;
    }
    
    throw new Error('OCR识别失败');
  } catch (error) {
    console.error('调用后端OCR失败:', error);
    throw error;
  }
}

// 添加图片转base64的辅助方法
async imageToBase64(imageUrl) {
  return new Promise((resolve, reject) => {
    uni.getFileSystemManager().readFile({
      filePath: imageUrl,
      encoding: 'base64',
      success: (res) => {
        // 移除data:image前缀
        const base64 = res.data.replace(/^data:image\/\w+;base64,/, '');
        resolve(base64);
      },
      fail: reject
    });
  });
}
```

### 3. 确保后端接口已配置正确

后端接口地址：`http://localhost:3000/api/v1/images/upload`

### 4. 测试

修改完成后，测试图片识别功能是否正常工作。

---

## 备选方案：前端直接调用百度OCR（不推荐）

如果暂时需要使用前端直接调用，需要在小程序配置中添加百度云OCR密钥：

```javascript
// aiService.js
const BAIDU_OCR_API_KEY = 'e8Hf2GgRQX9N3RRqj1uv6Ylb';
const BAIDU_OCR_SECRET_KEY = 'PQkWjyyr8OLaRSiK1ryTzh9LfjBIPn7n';
```

**注意**：这种方式会将API密钥暴露在前端，存在安全风险。

---

## 推荐采用的方案

**强烈推荐使用后端代理方案**，因为：
1. 更安全
2. 更容易控制成本
3. 更好的架构设计
