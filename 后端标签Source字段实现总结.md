# åç«¯æ ‡ç­¾ Source å­—æ®µå®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“ç»“æ„æ›´æ–°

**æ–‡ä»¶**: `add_tag_source_field.sql`

- âœ… åœ¨ `note_tags` è¡¨ä¸­æ·»åŠ  `source` å­—æ®µ
- âœ… ç±»å‹ï¼š`ENUM('manual', 'ai')`
- âœ… é»˜è®¤å€¼ï¼š`'ai'`ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰
- âœ… æ·»åŠ ç´¢å¼•ä»¥ä¼˜åŒ–æŸ¥è¯¢

### 2. ç¬”è®°æ§åˆ¶å™¨æ›´æ–°

**æ–‡ä»¶**: `src/controllers/noteController.js`

#### æ–°å¢åŠŸèƒ½ï¼š
- âœ… `normalizeTag()` - æ ‡ç­¾æ ¼å¼è§„èŒƒåŒ–å‡½æ•°ï¼ˆå…¼å®¹å­—ç¬¦ä¸²å’Œå¯¹è±¡ï¼‰
- âœ… ä¿®æ”¹ `attachTags()` - æ”¯æŒå­˜å‚¨ source å­—æ®µ
- âœ… ä¿®æ”¹ `fetchNoteWithTags()` - è¿”å›æ ‡ç­¾æ—¶åŒ…å« source å­—æ®µ
- âœ… ä¿®æ”¹ `fetchNotesListForUser()` - åˆ—è¡¨æŸ¥è¯¢æ—¶åŒ…å« source å­—æ®µ

#### æ›´æ–°çš„æ¥å£ï¼š
- âœ… `GET /api/v1/notes` - ç¬”è®°åˆ—è¡¨
- âœ… `GET /api/v1/notes/:id` - ç¬”è®°è¯¦æƒ…
- âœ… `GET /api/v1/notes/search` - æœç´¢ç¬”è®°
- âœ… `GET /api/v1/notes/by-category/:category` - æŒ‰åˆ†ç±»è·å–
- âœ… `GET /api/v1/notes/by-tag/:tag` - æŒ‰æ ‡ç­¾è·å–
- âœ… `POST /api/v1/notes` - åˆ›å»ºç¬”è®°ï¼ˆæ”¯æŒ sourceï¼‰
- âœ… `PUT /api/v1/notes/:id` - æ›´æ–°ç¬”è®°ï¼ˆæ”¯æŒ sourceï¼‰

### 3. è‰ç¨¿è·¯ç”±æ›´æ–°

**æ–‡ä»¶**: `src/routes/draft.js`

- âœ… ä¿®æ”¹ `fetchNoteWithTags()` - æ”¯æŒ source å­—æ®µ
- âœ… ä¿®æ”¹ `fetchNotesListForUser()` - æ”¯æŒ source å­—æ®µ
- âœ… æ–°å¢ `normalizeTag()` - æ ‡ç­¾è§„èŒƒåŒ–å‡½æ•°
- âœ… ä¿®æ”¹ `attachTagsToNote()` - æ”¯æŒå­˜å‚¨ source å­—æ®µ

---

## ğŸ“‹ æ ‡ç­¾æ ¼å¼æ”¯æŒ

### è¾“å…¥æ ¼å¼ï¼ˆå‘åå…¼å®¹ï¼‰

```javascript
// æ–¹å¼1ï¼šå­—ç¬¦ä¸²æ•°ç»„ï¼ˆé»˜è®¤ä¸º AIï¼‰
tags: ["æ ‡ç­¾1", "æ ‡ç­¾2"]

// æ–¹å¼2ï¼šå¯¹è±¡æ•°ç»„ï¼ˆæŒ‡å®š sourceï¼‰
tags: [
  {name: "æ ‡ç­¾1", source: "manual"},
  {name: "æ ‡ç­¾2", source: "ai"}
]

// æ–¹å¼3ï¼šæ··åˆæ ¼å¼ï¼ˆå…¼å®¹ï¼‰
tags: [
  "æ ‡ç­¾1",  // é»˜è®¤ä¸º AI
  {name: "æ ‡ç­¾2", source: "manual"}
]
```

### è¾“å‡ºæ ¼å¼ï¼ˆç»Ÿä¸€ï¼‰

```javascript
{
  "tags": [
    {"name": "æ ‡ç­¾1", "source": "manual"},
    {"name": "æ ‡ç­¾2", "source": "ai"}
  ]
}
```

---

## ğŸ”§ æ•°æ®åº“è¿ç§»æ­¥éª¤

### 1. æ‰§è¡Œè¿ç§»è„šæœ¬

```bash
# æ–¹å¼1ï¼šå‘½ä»¤è¡Œæ‰§è¡Œ
mysql -u root -p bunnies_dreamworld < add_tag_source_field.sql

# æ–¹å¼2ï¼šMySQL å®¢æˆ·ç«¯æ‰§è¡Œ
mysql> USE bunnies_dreamworld;
mysql> SOURCE add_tag_source_field.sql;
```

### 2. éªŒè¯è¿ç§»ç»“æœ

```sql
-- æ£€æŸ¥å­—æ®µæ˜¯å¦å­˜åœ¨
DESCRIBE note_tags;

-- åº”è¯¥çœ‹åˆ° source å­—æ®µ
-- Field: source
-- Type: enum('manual','ai')
-- Default: ai
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Source å­—æ®µä½ç½®

- âœ… **å­˜å‚¨åœ¨ `note_tags` è¡¨**ï¼ˆç¬”è®°-æ ‡ç­¾å…³è”è¡¨ï¼‰
- âŒ **ä¸å­˜å‚¨åœ¨ `tags` è¡¨**ï¼ˆæ ‡ç­¾åç§°è¡¨ï¼‰

**åŸå› **ï¼šåŒä¸€æ ‡ç­¾åœ¨ä¸åŒç¬”è®°ä¸­å¯èƒ½æœ‰ä¸åŒçš„ sourceï¼š
- ç¬”è®°Aï¼šæ ‡ç­¾"å­¦ä¹ "æ˜¯æ‰‹åŠ¨æ·»åŠ ï¼ˆsource: 'manual'ï¼‰
- ç¬”è®°Bï¼šæ ‡ç­¾"å­¦ä¹ "æ˜¯AIç”Ÿæˆï¼ˆsource: 'ai'ï¼‰

### 2. å‘åå…¼å®¹

- âœ… **æ¥æ”¶æ ¼å¼**ï¼šåŒæ—¶æ”¯æŒå­—ç¬¦ä¸²æ•°ç»„å’Œå¯¹è±¡æ•°ç»„
- âœ… **è¾“å‡ºæ ¼å¼**ï¼šç»Ÿä¸€è¿”å›å¯¹è±¡æ•°ç»„æ ¼å¼
- âœ… **æ—§æ•°æ®**ï¼šè‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ `source = 'ai'`

### 3. æ•°æ®éªŒè¯

- `name`: å¿…é¡»å­˜åœ¨ä¸”ä¸ä¸ºç©º
- `source`: å¿…é¡»æ˜¯ 'manual' æˆ– 'ai'ï¼Œå¦åˆ™é»˜è®¤ä¸º 'ai'

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. æµ‹è¯•åˆ›å»ºç¬”è®°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰

```bash
curl -X POST http://localhost:3000/api/v1/notes \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æµ‹è¯•ç¬”è®°",
    "content": "æµ‹è¯•å†…å®¹",
    "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
  }'
```

**é¢„æœŸ**ï¼šæ ‡ç­¾ source é»˜è®¤ä¸º 'ai'

### 2. æµ‹è¯•åˆ›å»ºç¬”è®°ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰

```bash
curl -X POST http://localhost:3000/api/v1/notes \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æµ‹è¯•ç¬”è®°",
    "content": "æµ‹è¯•å†…å®¹",
    "tags": [
      {"name": "æ ‡ç­¾1", "source": "manual"},
      {"name": "æ ‡ç­¾2", "source": "ai"}
    ]
  }'
```

**é¢„æœŸ**ï¼šæ ‡ç­¾ source æŒ‰æŒ‡å®šå€¼å­˜å‚¨

### 3. æµ‹è¯•è·å–ç¬”è®°

```bash
curl -X GET http://localhost:3000/api/v1/notes/123 \
  -H "Authorization: Bearer TOKEN"
```

**é¢„æœŸ**ï¼šè¿”å›çš„æ ‡ç­¾åŒ…å« source å­—æ®µ

---

## ğŸ“Š æ•°æ®æ ¼å¼å¯¹æ¯”

### ä¿®æ”¹å‰

```json
{
  "tags": ["æ ‡ç­¾1", "æ ‡ç­¾2"]
}
```

### ä¿®æ”¹å

```json
{
  "tags": [
    {"name": "æ ‡ç­¾1", "source": "ai"},
    {"name": "æ ‡ç­¾2", "source": "manual"}
  ]
}
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   mysql -u root -p bunnies_dreamworld < add_tag_source_field.sql
   ```

2. **é‡å¯åç«¯æœåŠ¡**
   ```bash
   # å¦‚æœä½¿ç”¨ PM2
   pm2 restart bunnies-backend
   
   # å¦‚æœä½¿ç”¨ npm
   npm restart
   ```

3. **éªŒè¯éƒ¨ç½²**
   - æµ‹è¯•åˆ›å»ºç¬”è®°ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰
   - æµ‹è¯•åˆ›å»ºç¬”è®°ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰
   - æµ‹è¯•è·å–ç¬”è®°ï¼ˆéªŒè¯ source å­—æ®µï¼‰

---

## ğŸ“„ ç›¸å…³æ–‡ä»¶

- `add_tag_source_field.sql` - æ•°æ®åº“è¿ç§»è„šæœ¬
- `src/controllers/noteController.js` - ç¬”è®°æ§åˆ¶å™¨ï¼ˆå·²æ›´æ–°ï¼‰
- `src/routes/draft.js` - è‰ç¨¿è·¯ç”±ï¼ˆå·²æ›´æ–°ï¼‰
- `åç«¯-æ ‡ç­¾Sourceå­—æ®µæ”¯æŒè¯´æ˜.md` - è¯¦ç»†æŠ€æœ¯æ–‡æ¡£

---

## âœ… å®ŒæˆçŠ¶æ€

- âœ… æ•°æ®åº“ç»“æ„å·²æ›´æ–°ï¼ˆéœ€è¦æ‰§è¡Œè¿ç§»è„šæœ¬ï¼‰
- âœ… ä»£ç å·²ä¿®æ”¹æ”¯æŒ source å­—æ®µ
- âœ… å‘åå…¼å®¹å­—ç¬¦ä¸²æ•°ç»„æ ¼å¼
- âœ… æ‰€æœ‰æ¥å£ç»Ÿä¸€è¿”å›å¯¹è±¡æ•°ç»„æ ¼å¼
- âœ… å…¼å®¹æ—§æ•°æ®ï¼ˆè‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ï¼‰
- âœ… è‰ç¨¿æ¥å£ä¹Ÿå·²æ›´æ–°æ”¯æŒ source å­—æ®µ

---

## ğŸ“ å‰ç«¯å¯¹æ¥è¯´æ˜

å‰ç«¯ç°åœ¨å¯ä»¥ï¼š

1. **åˆ›å»º/æ›´æ–°ç¬”è®°æ—¶**ï¼š
   - ä½¿ç”¨å­—ç¬¦ä¸²æ•°ç»„ï¼š`tags: ["æ ‡ç­¾1"]`ï¼ˆé»˜è®¤ä¸º AIï¼‰
   - ä½¿ç”¨å¯¹è±¡æ•°ç»„ï¼š`tags: [{name: "æ ‡ç­¾1", source: "manual"}]`

2. **æ¥æ”¶ç¬”è®°æ•°æ®æ—¶**ï¼š
   - ç»Ÿä¸€æ”¶åˆ°å¯¹è±¡æ•°ç»„æ ¼å¼ï¼š`[{name: "æ ‡ç­¾1", source: "manual"}]`
   - æ ¹æ® `source` å­—æ®µæ˜¾ç¤ºä¸åŒçš„é¢œè‰²æ ·å¼

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**
2. **é‡å¯åç«¯æœåŠ¡**
3. **é€šçŸ¥å‰ç«¯å›¢é˜Ÿ**ï¼šåç«¯å·²æ”¯æŒæ ‡ç­¾ source å­—æ®µ
4. **å‰ç«¯æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿åˆ›å»ºå’Œè·å–ç¬”è®°æ—¶æ ‡ç­¾æ ¼å¼æ­£ç¡®

