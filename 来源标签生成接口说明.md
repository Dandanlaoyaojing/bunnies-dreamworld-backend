# 来源标签生成接口说明

## 接口信息

**接口路径**: `POST /api/v1/ai/generate-source-tags`  
**认证要求**: 可选认证（可选）

## 功能说明

使用 DeepSeek AI 从笔记来源信息中智能提取并生成标签。

### 特点

1. ✅ **使用 DeepSeek AI** - 智能识别作者、书名等信息
2. ✅ **玫红色标签** - 生成的标签颜色统一为玫红色（#FF1493）
3. ✅ **区分作者和书名** - AI 能够区分作者姓名、书名、出版社等不同类型
4. ✅ **保持姓名完整** - 不会把作者名字分段
5. ✅ **去重处理** - 自动去重，不会生成重复标签
6. ✅ **JSON 格式返回** - 结构化的标签数据，包含类型信息

## 请求格式

```json
{
  "source": "《百年孤独》作者：加西亚·马尔克斯，出版社：南海出版公司"
}
```

## 响应格式

### 成功响应

```json
{
  "success": true,
  "message": "来源标签生成成功",
  "data": {
    "tags": [
      {
        "name": "加西亚·马尔克斯",
        "type": "author",
        "color": "#FF1493"
      },
      {
        "name": "百年孤独",
        "type": "book",
        "color": "#FF1493"
      },
      {
        "name": "南海出版公司",
        "type": "publisher",
        "color": "#FF1493"
      }
    ],
    "tagList": [...],
    "result": [...],
    "source": "《百年孤独》作者：加西亚·马尔克斯，出版社：南海出版公司"
  }
}
```

### 错误响应

```json
{
  "success": false,
  "error": "请提供笔记来源"
}
```

## 标签类型

返回的标签包含以下类型：

- `author` - 作者
- `book` - 书名/文章名
- `publisher` - 出版社/期刊
- `other` - 其他信息（年份、版本等）

## 使用示例

### 前端调用示例

```javascript
// 在保存笔记时，如果有来源信息，调用此接口生成标签
async function generateSourceTags(source) {
  try {
    const response = await wx.request({
      url: 'https://your-api-domain.com/api/v1/ai/generate-source-tags',
      method: 'POST',
      header: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}` // 如果需要认证
      },
      data: {
        source: source
      }
    });
    
    if (response.data.success) {
      const sourceTags = response.data.data.tags;
      // sourceTags 数组中的每个标签都包含：
      // - name: 标签名称
      // - type: 标签类型
      // - color: '#FF1493' (玫红色)
      
      // 将这些标签合并到笔记的标签列表中
      return sourceTags.map(tag => tag.name);
    }
  } catch (error) {
    console.error('生成来源标签失败:', error);
    return [];
  }
}
```

## 注意事项

1. **标签颜色**: 所有来源标签颜色固定为玫红色 `#FF1493`
2. **标签数量**: 通常生成 2-5 个标签，根据来源信息的内容决定
3. **去重机制**: 接口会自动去重，不会生成重复的标签
4. **姓名完整性**: AI 会保持作者姓名的完整性，不会分段
5. **错误处理**: 如果 AI 调用失败，会返回空数组而不是错误

## 与普通标签的区别

| 特性 | 来源标签 | 普通标签 |
|------|---------|---------|
| 颜色 | 玫红色 (#FF1493) | 默认颜色 |
| 生成方式 | 从来源信息提取 | 从笔记内容生成 |
| 类型信息 | 包含 type 字段 | 无类型字段 |
| 接口路径 | `/generate-source-tags` | `/generate-tags` |

## 最佳实践

1. **在保存笔记时调用**: 如果笔记有来源信息，在保存笔记前调用此接口生成标签
2. **合并标签**: 将来源标签与内容标签合并，但保持来源标签的玫红色
3. **前端显示**: 在前端显示时，可以根据 `color` 字段为标签设置颜色

