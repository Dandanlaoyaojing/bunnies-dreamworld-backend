# 草稿接口数据结构说明

## 您提供的数据格式

```json
{
  "success": true,
  "message": "获取草稿列表成功",
  "data": [
    {
      "id": "draft_001",
      "title": "草稿标题",
      "content": "草稿内容",
      "category": "knowledge",
      "tags": ["标签1", "标签2"]
    }
  ]
}
```

## 后端实际的数据格式

### 1. 获取草稿列表

**接口**: `GET /api/v1/drafts`

**实际返回**:
```json
{
  "success": true,
  "message": "获取草稿列表成功",
  "data": {
    "drafts": [
      {
        "id": 1,
        "title": "草稿标题",
        "content": "草稿内容",
        "category": "knowledge",
        "tags": "[\"标签1\",\"标签2\"]",  // JSON字符串
        "word_count": 100,
        "user_id": 1,
        "created_at": "2025-10-27T08:00:00.000Z",
        "updated_at": "2025-10-27T08:00:00.000Z",
        "created_at_formatted": "2025/10/27 08:00:00",
        "updated_at_formatted": "2025/10/27 08:00:00",
        "preview": "草稿内容的前100个字符..."
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1,
      "pages": 1
    }
  }
}
```

**关键差异**:
- ❌ `data` 不是数组，而是一个对象
- ✅ 数组在 `data.drafts` 中
- ✅ `tags` 是 JSON 字符串，需要解析
- ✅ 包含分页信息 `pagination`

### 2. 保存草稿

**接口**: `POST /api/v1/drafts`

**请求**:
```json
{
  "title": "草稿标题",
  "content": "草稿内容",
  "category": "knowledge",
  "tags": ["标签1", "标签2"]
}
```

**返回**:
```json
{
  "success": true,
  "message": "草稿保存成功",
  "data": {
    "id": 1,
    "word_count": 100
  }
}
```

### 3. 获取草稿详情

**接口**: `GET /api/v1/drafts/:id`

**返回**:
```json
{
  "success": true,
  "message": "获取草稿详情成功",
  "data": {
    "id": 1,
    "title": "草稿标题",
    "content": "草稿内容",
    "category": "knowledge",
    "tags": "[\"标签1\",\"标签2\"]",  // JSON字符串
    "word_count": 100,
    "user_id": 1,
    "created_at": "2025-10-27T08:00:00.000Z",
    "updated_at": "2025-10-27T08:00:00.000Z"
  }
}
```

## 前端处理建议

### 获取草稿列表时

```javascript
const response = await apiService.getDrafts();

// 正确：访问 data.drafts
const drafts = response.data.data.drafts;

// 错误：response.data.data 是数组
// const drafts = response.data.data;  ❌
```

### 处理tags字段

```javascript
// tags在数据库中是JSON字符串，需要解析
drafts.forEach(draft => {
  draft.tags = JSON.parse(draft.tags || '[]');
});
```

### 完整示例

```javascript
// 获取草稿列表
async function getDrafts() {
  const response = await apiService.getDrafts();
  
  if (response.data.success) {
    const { drafts, pagination } = response.data.data;
    
    // 解析tags
    const processedDrafts = drafts.map(draft => ({
      ...draft,
      tags: JSON.parse(draft.tags || '[]')
    }));
    
    return {
      drafts: processedDrafts,
      pagination
    };
  }
}
```

## 数据结构对比表

| 字段 | 您提供的格式 | 后端实际格式 | 说明 |
|------|-------------|-------------|------|
| `data` | 数组 | 对象 | 后端返回的是对象 |
| `drafts` | - | 数组 | 草稿列表在 `data.drafts` |
| `tags` | 数组 | JSON字符串 | 需要 `JSON.parse()` |
| `id` | "draft_001" | 整数 | 数据库自增ID |
| `pagination` | - | 对象 | 分页信息 |

## 前端代码修改

### 如果当前代码是：

```javascript
const drafts = response.data.data;  // ❌ 错误
```

### 应该改为：

```javascript
const { drafts, pagination } = response.data.data;  // ✅ 正确

// 解析tags
const processedDrafts = drafts.map(draft => ({
  ...draft,
  tags: JSON.parse(draft.tags || '[]')
}));
```

## 总结

后端接口工作正常，但数据结构与您的预期不完全匹配：
- ✅ 草稿列表在 `data.drafts` 而非 `data`
- ✅ `tags` 需要从 JSON 字符串解析为数组
- ✅ 包含额外的分页信息
