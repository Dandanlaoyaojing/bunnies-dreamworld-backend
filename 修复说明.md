# OCR认证问题修复说明

## 问题描述
图片识别失败，提示"要求提供有效的认证令牌"

## 原因分析
后端的 `/images/upload` 接口使用了全局认证中间件，导致未登录用户无法使用OCR功能

## 解决方案
修改 `src/routes/file.js`：
- 移除全局认证中间件
- 为需要认证的接口单独添加认证
- OCR接口 `/images/upload` 不需要登录即可使用

## 修改内容

### 修改前
```javascript
// 所有文件路由都需要认证
router.use(authenticate);
```

### 修改后
```javascript
// 部分文件路由需要认证
// router.use(authenticate); // 暂时移除全局认证，允许未登录用户进行OCR

// 图片上传和OCR识别 - 不需要认证，允许未登录用户使用
router.post('/images/upload', async (req, res) => {
  // ...
});

// 其他需要认证的接口单独添加
router.post('/files', authenticate, async (req, res) => {
  // ...
});
```

## 下一步
1. 重启后端服务器
2. 重新编译小程序
3. 测试图片识别功能

## 说明
这样的设计允许：
- 未登录用户可以使用OCR功能
- 登录用户可以享受更完整的功能
- 文件管理相关功能仍需要认证保护
